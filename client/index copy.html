<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./static/css/main.css">
    <title>MCAntiMalware</title>
</head>
<body>
    <h1>MCAntiMalware</h1>
    <form id="file-upload-form">
        <input type="file" id="file" name="filename" class="fileToUpload">
            <input type="submit" class="uploadButton">
        
    </form>
    <div class="console">
        <div class="box">
            <div class="statusbox">
                <p id="status">• Waiting...</p>
            </div>
            <p id="response">Waiting...</p>
            
        </div>
        
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        const color = (value) => {
            document.documentElement.style.setProperty('--statusColour', value);
        };

        color("#676a72")
        // handle form submission
        $('#file-upload-form').submit(function(event) {
          $("#status").html("• Checking")
          color("#f0b133")
          // prevent the default form submission behavior
          
          event.preventDefault();
          
          // get the file input element
          var fileInput = $('#file')[0];
          
          if (!fileInput.files[0]) {
            $("#status").html("• Failed")
            color("#f13f42")
            return $('#response').text("Critical error. No file set!")

          }
          color("#23a359")
          $("#status").html("• Scanning")
          $('#response').text("Scanning...")
          // create a new FormData object
          var formData = new FormData();
          
          // add the file to the FormData object
          formData.append('filename', fileInput.files[0]);
          
          // send the form data to the server using AJAX
          $.ajax({
            url: 'http://localhost/api/upload',
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function(response) {
                const message = response.message.replace(/\n/g, "<br>")
                console.log(message)
                if (response.success) {
                   /*const wa = document.getElementById("message")
                   wa.innerHTML = { message: message }*/
                    $("#response").html(message)
                    $("#status").html("• Finished")
                    color("#676a72")
                    // $('#response').text(message).addClass('success').removeClass('error');
                } else {
                    $('#response').text(message).addClass('error').removeClass('success');
                    $("#status").html("• Failed")
                    color("#f13f42")
                }

            },
            error: function(error) {
              // handle the error here
                console.error('File upload error:', error);
                $('#response').text('An error occurred. Please try again.').addClass('error').removeClass('success');
                $("#status").html("• Failed")
                color("#f13f42")
      

            }
          });
        });
      </script>
</body>
</html>